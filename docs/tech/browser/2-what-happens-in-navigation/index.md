# # 浏览器篇（二）- 输入URL回车发生了什么

老生常谈的问题导航栏输入URL回车到页面展示出来这个过程中发生了什么？结合上一篇浏览器架构的知识，我们来一探究竟。


## 页面控制

上一篇我们知道了Chrome 浏览器是多进程架构，进程之间分工协作。打开浏览器，除了Tab里面的内容，我们眼睛能看到的部分都是由浏览器进程来控制的。浏览器进程里面又有分工协作的线程，比如负责操作界面的UI线程（绘制操作按钮，地址导航栏），负责网络请求的网络线程，负责文件访问控制的存储线程。

![](./browserprocesses.png)

当我们在地址栏输入URL，浏览器进程的UI线程会负责处理。

## 过程分析

1. 输入

因为Chrome的地址栏既可以输入查询字符串又可以输入网址，所以UI线程需要判断输入的字符串到底是查询字符串还是网站URL。
![input](./input.png)

2. 回车

输入网址，敲下回车，此时UI线程告诉网络线程获取网站内容，此时标签的左上角开始转圈圈，网络线程此时会进行DNS查找、建立TLS连接。

![browserprocesses](./browserprocesses.png)

3. 响应

网络线程会根据response Header里面的Content-Type 来判断响应数据的类型，但是因为Content-Type有可能会缺失或者跟数据的实际类型不一致，所以这里会进行 MIME Type sniffing 。

如果返回的是HTML文档，则会交给渲染进程来处理；如果是文件比如PDF则会交给下载管理器进行下载。

这里会同时进行SafeBrowsing检测，如果站点的域名和响应数据匹配到已有的恶意站点，网络线程就抛出一个警告页面。此外还会进行 (CORB) 检查，保证敏感的跨站点数据不会进入到渲染器进程。

![sniff](./sniff.png)

4. 渲染







